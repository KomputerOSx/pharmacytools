rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // Contacts collection
    match /contacts/{contactId} {
      // Allow read if request comes with valid phonebook or admin pin
      // Note: Firestore can't check custom headers/params on reads,
      // so reads are protected at the app level via session auth
      allow read: if true;

      // Allow create/update only with valid admin PIN
      // The _pin field must match and will be stripped by the client before display
      allow create: if request.resource.data._pin == "261100";
      allow update: if request.resource.data._pin == "261100";

      // Deletes are protected at the app level (can't pass data with delete)
      // For extra security, you could restrict to authenticated users
      allow delete: if true;
    }

    // Deny access to all other collections by default
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
